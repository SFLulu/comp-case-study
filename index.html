<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compensation planning activity</title>

  <style>
    :root{
      --border:#d9d9d9;
      --border2:#ededed;
      --text:#111;
      --muted:#555;
      --bg:#fff;
      --card:#fff;
      --radius:14px;
      --pad:16px;
      --tap:44px;
      --gap:12px;
    }

    *{ box-sizing:border-box; }

    body{
      font-family:"Arial Nova", Arial, Helvetica, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin:0;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }

    /* Title */
    .pageTitle{
      font-size:44px;
      font-weight:900;
      margin:8px 0 18px;
      letter-spacing:-0.5px;
    }

    .card{
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:var(--pad);
      background:var(--card);
    }

    .card + .card{ margin-top:14px; }

    .big{
      font-size:32px;
      font-weight:900;
      margin:0 0 10px;
      line-height:1.15;
    }

    .muted{
      color:#2b2b2b;
      font-size:18px;
      line-height:1.35;
      margin:0;
    }

    /* Pots row */
    .pots{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      margin:16px 0 14px;
    }
    @media(max-width:520px){
      .pots{ grid-template-columns:1fr; }
    }

    .potLabel{
      font-size:22px;
      font-weight:900;
      margin-bottom:10px;
    }

    .potValue{
      font-size:48px;
      font-weight:900;
      line-height:1;
      margin-bottom:10px;
    }

    .potNote{
      font-size:18px;
      color:#444;
      margin:0;
    }

    /* Buttons */
    .btn{
      min-height:var(--tap);
      padding:10px 16px;
      border:1px solid #bfbfbf;
      border-radius:12px;
      background:#fff;
      cursor:pointer;
      font-size:18px;
      font-weight:600;
      font-family:inherit;
      line-height:1;
    }
    .btn:disabled{ opacity:.35; cursor:not-allowed; }

    .btnRow{
      display:flex;
      align-items:center;
      gap:12px;
      margin:12px 0;
      flex-wrap:wrap;
    }

    /* Desktop table */
    .desktopOnly{ display:block; }
    .mobileOnly{ display:none; }

    /* Switch to mobile cards on narrower viewports (common in SCORM iframe) */
    @media(max-width:860px){
      .desktopOnly{ display:none; }
      .mobileOnly{ display:block; }
    }

    .tableCard{ padding:0; overflow:hidden; }

    .tableTopPad{
      padding:var(--pad);
      border-bottom:1px solid var(--border2);
    }

    .tableScroll{
      max-height:560px;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }

    table{
      width:100%;
      border-collapse:collapse;
    }
    th, td{
      border-bottom:1px solid var(--border2);
      padding:16px 16px;
      vertical-align:top;
    }

    th{
      position:sticky;
      top:0;
      z-index:2;
      background:#fff;
      font-size:18px;
      font-weight:900;
      color:#222;
      text-align:left; /* header alignment fix */
    }

    /* column widths */
    col.emp{ width:28%; }
    col.ctx{ width:32%; }
    col.mer{ width:20%; }
    col.bon{ width:20%; }

    .name{
      font-size:28px;
      font-weight:900;
      margin:0 0 4px;
      line-height:1.1;
    }
    .title{
      font-size:18px;
      color:#444;
      margin:0 0 4px;
    }
    .metaLine{
      font-size:18px;
      margin:0;
      color:#444;
    }
    .metaLine strong{ color:#111; font-weight:900; }

    .ctxLabel{
      font-size:18px;
      color:#444;
      margin:0;
    }
    .ctxPay{
      font-size:34px;
      font-weight:900;
      margin:4px 0 8px;
    }
    .ctxLine{
      font-size:18px;
      margin:0;
      color:#444;
    }
    .ctxLine strong{ color:#111; font-weight:900; }
    .ctxNote{
      margin-top:8px;
      font-style:italic;
      color:#444;
      font-size:18px;
    }

    .allocLabel{
      font-size:18px;
      color:#444;
      margin:0;
    }
    .allocValue{
      font-size:34px;
      font-weight:900;
      margin:4px 0 10px;
    }
    .allocBtns{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .rangeNote{
      margin-top:10px;
      font-style:italic;
      font-size:16px;
      color:#111; /* black italics */
    }

    /* Mobile cards */
    .mobileColKey{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid var(--border2);
      background:#fff;
      position:sticky;
      top:0;
      z-index:3;
    }
    .mobileColKey .k{
      font-weight:900;
      font-size:18px;
      color:#222;
    }

    .empCard{
      padding:16px;
      border-bottom:1px solid var(--border2);
      background:#fff;
    }
    .empCard:last-child{ border-bottom:none; }

    .mobileGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top:14px;
    }

    .subCard{
      border:1px solid var(--border2);
      border-radius:14px;
      padding:14px;
      background:#fff;
    }

    .subTitle{
      font-weight:900;
      font-size:18px;
      margin:0 0 8px;
      color:#222;
    }

    .subValueBig{
      font-size:34px;
      font-weight:900;
      margin:4px 0 8px;
    }

    .smallLine{
      margin:0;
      font-size:18px;
      color:#444;
      line-height:1.3;
    }
    .smallLine strong{ font-weight:900; color:#111; }

    /* Make the table usable in narrow iframes: allow horizontal scroll instead of collapsing */
    .tableScroll{
      overflow-x:auto;
    }
    table{
      min-width: 980px; /* keeps headers visible even if iframe is narrow */
    }
    @media(max-width:860px){
      table{ min-width: 0; } /* mobile uses cards instead */
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="pageTitle">Compensation planning activity</div>

    <div class="card">
      <div class="big">Allocate funds to your team</div>
      <p class="muted">
        Use the +$500 / −$500 buttons to allocate merit and bonus funds to your employees. Totals update automatically.
        You do not need to use your entire merit or bonus budgets.
      </p>
    </div>

    <div class="pots">
      <div class="card potCard">
        <div class="potLabel">Merit budget remaining</div>
        <div class="potValue" id="meritRemaining">$0</div>
        <p class="potNote">Allocations must be in $500 increments.</p>
      </div>

      <div class="card potCard">
        <div class="potLabel">Bonus budget remaining</div>
        <div class="potValue" id="bonusRemaining">$0</div>
        <p class="potNote">Allocations must be in $500 increments.</p>
      </div>
    </div>

    <div class="btnRow">
      <button class="btn" id="resetBtn" type="button">Reset allocations</button>
    </div>

    <!-- DESKTOP TABLE -->
    <div class="card tableCard desktopOnly">
      <div class="tableScroll">
        <table aria-label="Compensation allocation table">
          <colgroup>
            <col class="emp" />
            <col class="ctx" />
            <col class="mer" />
            <col class="bon" />
          </colgroup>
          <thead>
            <tr>
              <th>Employee</th>
              <th>Context</th>
              <th>Merit</th>
              <th>Bonus</th>
            </tr>
          </thead>
          <tbody id="tbodyDesktop"></tbody>
        </table>
      </div>
    </div>

    <!-- MOBILE CARDS -->
    <div class="card tableCard mobileOnly">
      <div class="mobileColKey">
        <div class="k">Employee</div>
        <div class="k">Context / Merit / Bonus</div>
      </div>
      <div id="mobileList"></div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    const STEP = 500;

    // Budget totals (from your screenshots)
    const TOTAL_MERIT = 13500;
    const TOTAL_BONUS = 32000;

    // Employees + display fields (all font colors remain black; ranges are black italics via CSS)
    const employees = [
      {
        id:"ines",
        name:"Ines",
        title:"Business Analyst",
        performance:"Exceptional",
        basePay:70000,
        payRelative:"Competitive",
        note:"Filled in for maternity leave",
        meritRange:[2000,4000],
        bonusRange:[4000,5500]
      },
      {
        id:"ananya",
        name:"Ananya",
        title:"Sr Business Analyst",
        performance:"Successful",
        basePay:80000,
        payRelative:"Low",
        note:"",
        meritRange:[1000,3000],
        bonusRange:[3500,5500]
      },
      {
        id:"jace",
        name:"Jace",
        title:"Sr Business Analyst",
        performance:"Successful",
        basePay:85000,
        payRelative:"Competitive",
        note:"",
        meritRange:[1500,3000],
        bonusRange:[4500,5500]
      },
      {
        id:"miles",
        name:"Miles",
        title:"Business Manager",
        performance:"Improve",
        basePay:130000,
        payRelative:"Competitive",
        note:"",
        meritRange:[0,2000],
        bonusRange:[0,6500]
      },
      {
        id:"emilio",
        name:"Emilio",
        title:"Business Analyst",
        performance:"Improve",
        basePay:80000,
        payRelative:"High",
        note:"",
        meritRange:[0,1000],
        bonusRange:[0,2500]
      }
    ];

    // ====== STATE ======
    const state = {};
    function initState(){
      employees.forEach(e=>{
        state[e.id] = { merit:0, bonus:0 };
      });
    }

    function fmtMoney(n){
      return n.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});
    }
    function fmtPlainMoney(n){
      return "$" + n.toLocaleString("en-US");
    }
    function fmtRange(min,max){
      return `${fmtPlainMoney(min)}–${fmtPlainMoney(max)}`;
    }

    function totalsAllocated(){
      let m=0,b=0;
      employees.forEach(e=>{
        m += state[e.id].merit;
        b += state[e.id].bonus;
      });
      return {m,b};
    }

    function remaining(){
      const t = totalsAllocated();
      return {
        merit: TOTAL_MERIT - t.m,
        bonus: TOTAL_BONUS - t.b
      };
    }

    // ====== RENDER ======
    function renderPots(){
      const r = remaining();
      document.getElementById("meritRemaining").textContent = fmtMoney(r.merit);
      document.getElementById("bonusRemaining").textContent = fmtMoney(r.bonus);
    }

    function canAdd(type){
      const r = remaining();
      return type === "merit" ? r.merit >= STEP : r.bonus >= STEP;
    }

    function buildAllocControls(empId, type){
      const addId = `${empId}_${type}_add`;
      const subId = `${empId}_${type}_sub`;
      return `
        <div class="allocBtns">
          <button class="btn" type="button" id="${addId}">+ ${fmtPlainMoney(STEP)}</button>
          <button class="btn" type="button" id="${subId}">− ${fmtPlainMoney(STEP)}</button>
        </div>
      `;
    }

    function renderDesktop(){
      const tbody = document.getElementById("tbodyDesktop");
      tbody.innerHTML = employees.map(e=>{
        const s = state[e.id];
        return `
          <tr>
            <td>
              <div class="name">${e.name}</div>
              <div class="title">${e.title}</div>
              <p class="metaLine">Performance: <strong>${e.performance}</strong></p>
            </td>

            <td>
              <p class="ctxLabel">Base pay</p>
              <div class="ctxPay">${fmtMoney(e.basePay)}</div>
              <p class="ctxLine">Pay relative: <strong>${e.payRelative}</strong></p>
              ${e.note ? `<div class="ctxNote">${e.note}</div>` : ``}
            </td>

            <td>
              <p class="allocLabel">Allocated</p>
              <div class="allocValue">${fmtMoney(s.merit)}</div>
              ${buildAllocControls(e.id,"merit")}
              <div class="rangeNote">Merit Budget Range: ${fmtRange(e.meritRange[0], e.meritRange[1])}</div>
            </td>

            <td>
              <p class="allocLabel">Allocated</p>
              <div class="allocValue">${fmtMoney(s.bonus)}</div>
              ${buildAllocControls(e.id,"bonus")}
              <div class="rangeNote">Bonus Budget Range: ${fmtRange(e.bonusRange[0], e.bonusRange[1])}</div>
            </td>
          </tr>
        `;
      }).join("");

      // Wire events after HTML exists
      employees.forEach(e=>{
        wireButtons(e.id,"merit");
        wireButtons(e.id,"bonus");
      });

      syncButtonStates();
    }

    function renderMobile(){
      const list = document.getElementById("mobileList");
      list.innerHTML = employees.map(e=>{
        const s = state[e.id];
        return `
          <div class="empCard">
            <div class="name">${e.name}</div>
            <div class="title">${e.title}</div>
            <p class="metaLine">Performance: <strong>${e.performance}</strong></p>

            <div class="mobileGrid">
              <div class="subCard">
                <div class="subTitle">Context</div>
                <p class="smallLine">Base pay</p>
                <div class="subValueBig">${fmtMoney(e.basePay)}</div>
                <p class="smallLine">Pay relative: <strong>${e.payRelative}</strong></p>
                ${e.note ? `<p class="smallLine" style="font-style:italic;margin-top:8px;">${e.note}</p>` : ``}
              </div>

              <div class="subCard">
                <div class="subTitle">Merit</div>
                <p class="smallLine">Allocated</p>
                <div class="subValueBig">${fmtMoney(s.merit)}</div>
                ${buildAllocControls(e.id,"merit")}
                <div class="rangeNote">Merit Budget Range: ${fmtRange(e.meritRange[0], e.meritRange[1])}</div>
              </div>

              <div class="subCard">
                <div class="subTitle">Bonus</div>
                <p class="smallLine">Allocated</p>
                <div class="subValueBig">${fmtMoney(s.bonus)}</div>
                ${buildAllocControls(e.id,"bonus")}
                <div class="rangeNote">Bonus Budget Range: ${fmtRange(e.bonusRange[0], e.bonusRange[1])}</div>
              </div>
            </div>
          </div>
        `;
      }).join("");

      employees.forEach(e=>{
        wireButtons(e.id,"merit");
        wireButtons(e.id,"bonus");
      });

      syncButtonStates();
    }

    function syncButtonStates(){
      // Disable + if pot remaining < STEP
      const addMeritOk = canAdd("merit");
      const addBonusOk = canAdd("bonus");

      employees.forEach(e=>{
        const st = state[e.id];

        const mAdd = document.getElementById(`${e.id}_merit_add`);
        const mSub = document.getElementById(`${e.id}_merit_sub`);
        const bAdd = document.getElementById(`${e.id}_bonus_add`);
        const bSub = document.getElementById(`${e.id}_bonus_sub`);

        if(mAdd) mAdd.disabled = !addMeritOk;
        if(bAdd) bAdd.disabled = !addBonusOk;

        if(mSub) mSub.disabled = st.merit <= 0;
        if(bSub) bSub.disabled = st.bonus <= 0;
      });
    }

    function wireButtons(empId, type){
      const add = document.getElementById(`${empId}_${type}_add`);
      const sub = document.getElementById(`${empId}_${type}_sub`);

      if(add && !add.dataset.wired){
        add.dataset.wired = "1";
        add.addEventListener("click", ()=>{
          if(!canAdd(type)) return;
          state[empId][type] += STEP;
          rerender();
        });
      }

      if(sub && !sub.dataset.wired){
        sub.dataset.wired = "1";
        sub.addEventListener("click", ()=>{
          if(state[empId][type] <= 0) return;
          state[empId][type] -= STEP;
          rerender();
        });
      }
    }

    function rerender(){
      renderPots();
      // Render both; CSS decides what is visible (important for SCORM sizing quirks)
      renderDesktop();
      renderMobile();
    }

    // ====== INIT ======
    initState();
    rerender();

    document.getElementById("resetBtn").addEventListener("click", ()=>{
      initState();
      rerender();
    });
  </script>
</body>
</html>
