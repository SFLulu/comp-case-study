<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compensation Case Study Allocator</title>

  <style>
    body { font-family: Arial, sans-serif; margin: 16px; background: #ffffff; }
    .wrap { max-width: 1100px; margin: 0 auto; }

    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; background: #fff; }
    .big { font-size: 20px; font-weight: 700; }
    .muted { color: #666; font-size: 12px; }
    .tot { font-weight: 700; margin-top: 2px; }

    /* Pots */
    .pots { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; margin-bottom: 16px; }
    .potLabel { font-size: 14px; font-weight: 700; color: #444; margin-bottom: 4px; }

    /* Table */
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border-bottom: 1px solid #eee; padding: 10px; vertical-align: top; }
    th { text-align: left; font-size: 12px; color: #444; }
    .rowTitle { font-weight: 700; margin-bottom: 2px; }

    /* Buttons */
    .btn { padding: 6px 10px; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; font-size: 13px; }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .btns { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }
    .footer { display: flex; align-items: center; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
    .warn { color: #b00020; font-size: 12px; }

    /* Employee meta */
    .meta { margin-top: 4px; font-size: 12px; line-height: 1.3; }
    .meta .label { color: #666; }
    .meta .value { font-weight: 700; color: #000; }
    .meta .note { color: #666; font-style: italic; }

    /* NEW: Budget range callouts under Merit/Bonus buttons */
    .rangeNote {
      margin-top: 6px;
      font-size: 12px;
      color: #000;
      font-style: italic; /* per request */
    }

    /* Fatal error box if JS breaks */
    #fatalErrorBox { display:none; border: 2px solid #b00020; background: #fff5f5; border-radius: 12px; padding: 12px; margin-bottom: 12px; }
    #fatalErrorBox .title { font-weight: 800; color:#b00020; }
    #fatalErrorBox pre { white-space: pre-wrap; font-size: 12px; margin: 8px 0 0 0; }
  </style>
</head>

<body>
<div class="wrap">

  <!-- Fatal error box (only shows if JS breaks) -->
  <div id="fatalErrorBox">
    <div class="title">Something broke in the allocator (JavaScript error)</div>
    <div class="muted">Copy the error text below and paste it back to troubleshoot.</div>
    <pre id="fatalErrorText"></pre>
  </div>

  <!-- INSTRUCTIONS -->
  <div class="card">
    <div class="big">Allocate funds to your team</div>
    <div class="muted">
      Use the +$500 / –$500 buttons to allocate merit and bonus funds to your employees. Totals update automatically.
      You do not need to use your entire merit or bonus budgets. Once you’re complete, click on the employee cards
      to compare your budget with the recommended answers.
    </div>
  </div>

  <!-- POTS -->
  <div class="pots">
    <div class="card">
      <div class="potLabel">Merit pot remaining</div>
      <div id="meritRemaining" class="big">$0</div>
      <div class="muted">Allocations must be in $500 increments.</div>
    </div>

    <div class="card">
      <div class="potLabel">Bonus pot remaining</div>
      <div id="bonusRemaining" class="big">$0</div>
      <div class="muted">Allocations must be in $500 increments.</div>
    </div>
  </div>

  <!-- Allocation Table -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th style="width:32%;">Employee</th>
          <th style="width:28%;">Context</th>
          <th style="width:20%;">Merit</th>
          <th style="width:20%;">Bonus</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <div class="footer">
      <button class="btn" id="resetBtn">Reset allocations</button>
      <!-- Finished button REMOVED per request -->
      <span class="warn" id="warning"></span>
    </div>

  </div>

</div>

<script>
(() => {
  "use strict";

  function showFatalError(err) {
    const box = document.getElementById("fatalErrorBox");
    const text = document.getElementById("fatalErrorText");
    if (box && text) {
      box.style.display = "block";
      text.textContent = String(err && err.stack ? err.stack : err);
    }
  }

  try {
    /* =========================
       CONFIGURATION
    ========================== */

    const DENOMINATION = 500;

    // Starting pots (keep as-is unless you want different totals)
    const START_MERIT = 13500;
    const START_BONUS = 32000;

    // Recommended answers (kept for future use; not displayed here)
    const recommended = {
      Ines:   { merit: 0, bonus: 0 },
      Ananya: { merit: 0, bonus: 0 },
      Jace:   { merit: 0, bonus: 0 },
      Miles:  { merit: 0, bonus: 0 },
      Emilio: { merit: 0, bonus: 0 }
    };

    // Budget ranges to DISPLAY (per screenshot). Font must be black + italics.
    const budgetRanges = {
      Ines:   { merit: [2000, 4000], bonus: [4000, 5500] },
      Ananya: { merit: [1000, 3000], bonus: [3500, 5500] },
      Jace:   { merit: [1500, 3000], bonus: [4500, 5500] },
      Miles:  { merit: [0, 2000],    bonus: [0, 6500] },
      Emilio: { merit: [0, 1000],    bonus: [0, 2500] }
    };

    // Employee roster
    const employees = [
      {
        empName: "Ines",
        title: "Business Analyst",
        basePay: 70000,
        performanceRating: "Exceptional",
        payRelative: "Competitive",
        notes: "Filled in for maternity leave",
        merit: 0,
        bonus: 0
      },
      {
        empName: "Ananya",
        title: "Sr Business Analyst",
        basePay: 80000,
        performanceRating: "Successful",
        payRelative: "Low",
        notes: "",
        merit: 0,
        bonus: 0
      },
      {
        empName: "Jace",
        title: "Sr Business Analyst",
        basePay: 85000,
        performanceRating: "Successful",
        payRelative: "Competitive",
        notes: "",
        merit: 0,
        bonus: 0
      },
      {
        empName: "Miles",
        title: "Business Manager",
        basePay: 130000,
        performanceRating: "Improve",
        payRelative: "Competitive",
        notes: "",
        merit: 0,
        bonus: 0
      },
      {
        empName: "Emilio",
        title: "Business Analyst",
        basePay: 80000,
        performanceRating: "Improve",
        payRelative: "High",
        notes: "",
        merit: 0,
        bonus: 0
      }
    ];

    /* =========================
       STATE
    ========================== */

    let meritRemaining = START_MERIT;
    let bonusRemaining = START_BONUS;

    const fmt = (n) => n.toLocaleString("en-US", {
      style: "currency",
      currency: "USD",
      maximumFractionDigits: 0
    });

    const elMeritRemaining = document.getElementById("meritRemaining");
    const elBonusRemaining = document.getElementById("bonusRemaining");
    const elRows = document.getElementById("rows");
    const elWarning = document.getElementById("warning");
    const elResetBtn = document.getElementById("resetBtn");

    const required = [elMeritRemaining, elBonusRemaining, elRows, elWarning, elResetBtn];
    if (required.some(x => !x)) {
      throw new Error("One or more required elements are missing from the page. (IDs changed or HTML not pasted fully.)");
    }

    function setWarning(msg) {
      elWarning.textContent = msg || "";
    }

    function rangeText(lowHigh) {
      const low = lowHigh[0];
      const high = lowHigh[1];
      return `${fmt(low)}-${fmt(high)}`;
    }

    function render() {
      elMeritRemaining.textContent = fmt(meritRemaining);
      elBonusRemaining.textContent = fmt(bonusRemaining);

      elRows.innerHTML = "";

      employees.forEach((e, idx) => {
        const r = budgetRanges[e.empName];

        const tr = document.createElement("tr");

        // Employee column
        const tdEmp = document.createElement("td");
        tdEmp.innerHTML = `
          <div class="rowTitle">${e.empName}</div>
          <div class="muted">${e.title}</div>
          <div class="meta">
            <span class="label">Performance Rating:</span> <span class="value">${e.performanceRating}</span>
          </div>
        `;
        tr.appendChild(tdEmp);

        // Context column
        const tdCtx = document.createElement("td");
        tdCtx.innerHTML = `
          <div class="muted">Base pay</div>
          <div class="tot">${fmt(e.basePay)}</div>
          <div class="meta" style="margin-top:6px;">
            <span class="label">Pay Relative to Others:</span> <span class="value">${e.payRelative}</span>
            ${e.notes ? `<div class="note" style="margin-top:4px;">${e.notes}</div>` : ""}
          </div>
        `;
        tr.appendChild(tdCtx);

        // Merit column
        const tdMerit = document.createElement("td");
        tdMerit.innerHTML = `
          <div class="muted">Allocated</div>
          <div class="tot">${fmt(e.merit)}</div>
          <div class="btns">
            <button class="btn" ${meritRemaining < DENOMINATION ? "disabled" : ""} data-action="meritPlus" data-idx="${idx}">+ $500</button>
            <button class="btn" ${e.merit < DENOMINATION ? "disabled" : ""} data-action="meritMinus" data-idx="${idx}">– $500</button>
          </div>
          ${r ? `<div class="rangeNote">Merit Budget Range: ${rangeText(r.merit)}</div>` : ``}
        `;
        tr.appendChild(tdMerit);

        // Bonus column
        const tdBonus = document.createElement("td");
        tdBonus.innerHTML = `
          <div class="muted">Allocated</div>
          <div class="tot">${fmt(e.bonus)}</div>
          <div class="btns">
            <button class="btn" ${bonusRemaining < DENOMINATION ? "disabled" : ""} data-action="bonusPlus" data-idx="${idx}">+ $500</button>
            <button class="btn" ${e.bonus < DENOMINATION ? "disabled" : ""} data-action="bonusMinus" data-idx="${idx}">– $500</button>
          </div>
          ${r ? `<div class="rangeNote">Bonus Budget Range: ${rangeText(r.bonus)}</div>` : ``}
        `;
        tr.appendChild(tdBonus);

        elRows.appendChild(tr);
      });
    }

    function adjust(idx, type, delta) {
      setWarning("");

      if (type === "merit") {
        if (delta > 0 && meritRemaining < DENOMINATION) return setWarning("Merit pot is empty.");
        if (delta < 0 && employees[idx].merit < DENOMINATION) return;
        employees[idx].merit += delta;
        meritRemaining -= delta;
      }

      if (type === "bonus") {
        if (delta > 0 && bonusRemaining < DENOMINATION) return setWarning("Bonus pot is empty.");
        if (delta < 0 && employees[idx].bonus < DENOMINATION) return;
        employees[idx].bonus += delta;
        bonusRemaining -= delta;
      }

      render();
    }

    // +/– button clicks
    document.addEventListener("click", (ev) => {
      const btn = ev.target.closest("button[data-action]");
      if (!btn) return;

      const idx = Number(btn.dataset.idx);
      const action = btn.dataset.action;

      if (action === "meritPlus")  adjust(idx, "merit",  DENOMINATION);
      if (action === "meritMinus") adjust(idx, "merit", -DENOMINATION);
      if (action === "bonusPlus")  adjust(idx, "bonus",  DENOMINATION);
      if (action === "bonusMinus") adjust(idx, "bonus", -DENOMINATION);
    });

    // Reset
    elResetBtn.addEventListener("click", () => {
      employees.forEach(e => { e.merit = 0; e.bonus = 0; });
      meritRemaining = START_MERIT;
      bonusRemaining = START_BONUS;
      setWarning("");
      render();
    });

    render();

  } catch (err) {
    showFatalError(err);
  }
})();
</script>

</body>
</html>
